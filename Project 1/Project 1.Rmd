---
title: "Project 1"
author: "Anna Brown, Rishika Deshmukh, and Ada Zhang"
date: "`r Sys.Date()`"
output:
     html_document:
          toc: true
          toc_depth: 2
          toc_float: true
          theme: cosmo
          code_folding: hide
---
```{r echo=FALSE, warning=FALSE, message=FALSE, results="hide"}
# Load required libraries
library(countrycode)
library(dplyr)
library(ggplot2)
library(leaflet)
library(maps)
library(patchwork)
library(readr)
library(tidyverse)
library(DT)

# Set the file path
url <- "https://raw.githubusercontent.com/annab0503/DS4002/main/Project%201/Analysis%20Data/analysis_data.csv"

# Read the CSV file from the URL
analysis_data <- read_csv(url)
```

<h1 style="text-align: center;">Introduction</h1> 

**What shapes the United States' approach to issuing visas?** Is it foreign economic performance, shifting domestic priorities, or political agendas? Visa issuance reflects dynamic priorities and evolving international trends. This research explores how economic factors, such as foreign GDP, and U.S. policy decisions influence visa issuance and examines how the U.S. balances domestic needs, foreign relations, and economic realities.

Among the many U.S. visa categories, three key types most closely tied to economic outcomes are the focus of this analysis:

- **Student and Exchange Visitor Visas**: Fostering human capital development (e.g., F-1 for academic students, J-1 for exchange visitors, and M-1 for vocational students).  
- **Skilled Labor Visas**: Supplying specialized expertise (e.g., H-1B for specialty workers, L-1 for intra-company transferees, and O-1 for extraordinary ability individuals).  
- **Unskilled Labor Visas**: Supporting essential workforce needs (e.g., H-2A for agricultural workers and H-2B for temporary non-agricultural workers).  

By examining these categories, we investigate how economic indicators, government policies, and labor market demands shape visa issuance trends. Specifically, this study asks:  
- Do foreign GDP levels correlate with visa allocation?  
- How do presidential administrations influence visa policies?  
- Are skilled workers prioritized during economic growth?  
- How do policy changes affect unskilled labor opportunities?  

This analysis sheds light on the intersection of U.S. immigration policy and global economic conditions, offering insights into how the U.S. adapts its visa strategies to evolving domestic and international needs.

<h1 style="text-align: center;">Background</h1> 

The U.S. immigration system encompasses a diverse range of visa categories designed to meet both the aspirations of foreign nationals and the economic needs of the country. Among these, three visa categories—**Student and Exchange Visitor Visas**, **Skilled Labor Visas**, and **Unskilled Labor Visas**—stand out for their significant economic impact. These categories represent critical components of a thriving economy: **human capital development** through international students and exchange visitors, **specialized expertise** provided by skilled labor, and **essential workforce support** through unskilled labor. This research focuses on understanding how these categories shape foreign worker flows and their contributions to the U.S. economy in the context of evolving policies and economic factors.  

## Skilled Labor Visas  

The **H-1B visa** is the most prominent skilled labor visa, allowing U.S. employers to hire highly skilled foreign professionals for specialty occupations requiring advanced knowledge and at least a bachelor’s degree or its equivalent. Over the years, the H-1B program has been influenced by economic and political factors. For instance, in 1998, high-tech industry lobbying led to proposals to increase the H-1B visa cap, citing a significant unmet demand for skilled workers. In response, the **American Competitiveness in the 21st Century Act** temporarily raised the cap to 195,000 between 2001 and 2003, before reverting to 65,000 in 2004. The 2008 recession brought further scrutiny, with Congress targeting the program to protect domestic jobs, resulting in a decline in filed petitions. These fluctuations underscore the program’s sensitivity to broader economic conditions and labor market demands.  

## Student and Exchange Visitor Visas  

Visas such as the **F-1, J-1,** and **M-1** facilitate international education and cultural exchange in the U.S., playing a key role in human capital development. Policies have evolved over time to ensure better regulation and monitoring of international students. For example, the 1996 **Illegal Immigration Reform and Immigrant Responsibility Act** (IIRIRA) introduced measures to track foreign students, while the 2003 implementation of the **Student and Exchange Visitor Information System** (SEVIS) improved monitoring capabilities. Under the Obama administration, the federal **Optional Practical Training (OPT)** program was expanded for STEM students, reflecting the importance of international talent in innovation and research. However, the Trump administration tightened F-1 visa regulations, proposing fixed-term policies and stricter evaluations, highlighting how political priorities influence visa policies.  

## Unskilled Labor Visas  

Unskilled labor visas, including the **H-2A** and **H-2B**, address the demand for temporary agricultural and non-agricultural labor, respectively. The H-2A visa supports agricultural operations during peak seasons, ensuring labor availability for tasks such as planting and harvesting, while the H-2B visa fills gaps in industries like hospitality, construction, and landscaping. These visas are crucial for industries reliant on seasonal or peak-period labor, reflecting the essential role of temporary workers in maintaining economic stability in key sectors.  

## Economic Perspectives on Foreign Workers  

Economic discussions about foreign workers revolve around their contributions to growth and innovation as well as concerns about their impact on the domestic labor market. Proponents argue that foreign workers fill critical labor shortages, enhance innovation, and sustain industries with fluctuating labor demands. For example, H-1B visa holders are often associated with technological advancements, patents, and entrepreneurial activities that drive competitiveness. Similarly, unskilled labor visas ensure the stability of sectors like agriculture and tourism, which are vital to the U.S. economy.  

Critics, however, caution against potential wage suppression and increased competition for domestic workers, emphasizing the need for careful policy design to ensure equitable benefits. This research delves into these dynamics, examining how U.S. visa policies reflect broader economic priorities and labor market realities while balancing domestic interests with international interdependence.

<h1 style="text-align: center;">Methodology</h1> 

## Data Sources

Our analysis draws on three primary data sources (originally accessed on January 2, 2025), each providing unique insights into visa trends and the broader economic landscape:

###  [U.S. State Department](https://travel.state.gov/content/travel/en/legal/visa-law0/visa-statistics/nonimmigrant-visa-statistics.html){.btn .btn-primary}
The U.S. State Department's visa statistics offer detailed records of nonimmigrant visas issued by type and country of origin. This dataset is pivotal in understanding trends over time, including shifts in the distribution of student, skilled labor, and unskilled labor visas. Researchers have historically relied on this dataset to assess the effects of policy changes on international mobility.

### [World Bank](https://wits.worldbank.org/CountryProfile/en/country/by-country/startyear/ltst/endyear/ltst/indicator/NY-GDP-MKTP-CD#){.btn .btn-primary}
Economic indicators, particularly Gross Domestic Product (GDP) data measured in current U.S. dollars, were sourced from the World Bank’s database. These metrics provide a foundation for examining how global economic performance correlates with U.S. visa issuance. For example, GDP data has been a cornerstone of studies investigating global disparities and their implications for migration patterns.

### [U.S. Census Bureau](https://www.census.gov/data-tools/demo/idb/#/table?dashboard_page=country&COUNTRY_YR_ANIM=2025&menu=tableViz&quickReports=CUSTOM&CUSTOM_COLS=POP,GR,RNI,POP_DENS,CBR,CDR,NMR,NIM&TABLE_RANGE=1997,2014&TABLE_YEARS=1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2025&TABLE_USE_RANGE=Y&TABLE_USE_YEARS=Y&TABLE_STEP=1&TABLE_ADD_YEARS=2025){.btn .btn-primary}
Demographic data from the U.S. Census Bureau's International Data Base (IDB) offered critical context on population dynamics, including growth rates, migration patterns, and population density. These variables are essential for understanding the socio-economic backdrop influencing visa policies.

## Data Cleaning and Integration

To ensure accuracy and compatibility, we executed a rigorous data-cleaning process in Python using a Jupyter Notebook. This process involved:

- **Standardizing Variables**: Key variables such as country names were standardized across datasets to ensure consistency.
- **Handling Missing Data**: Missing values were identified and treated based on the nature of the variable, employing methods such as imputation or exclusion where appropriate.
- **Merging Datasets**: The cleaned datasets were integrated into a unified dataframe using shared keys like country and fiscal year, allowing for seamless analysis across multiple dimensions.
- **Validation**: Cross-referencing with original sources ensured the accuracy of merged data and derived variables.

Detailed replication documents, including the Python code used for cleaning and merging, are available in our GitHub repository.

## Variables for Analysis

Our cleaned dataset includes the following variables, each essential for addressing our research questions:

| Variable                       | Description                                                                             | Source                |
|--------------------------------|-----------------------------------------------------------------------------------------|-----------------------|
| Country                        | geographic entity of interest                                                           | All                   |
| Fiscal Year                    | year for which data is reported, based on the U.S. fiscal calendar                      | All                   |
| Visa Category                  | classification of U.S. visas issued (e.g., unskilled labor, skilled labor, student)     | U.S. State Department |
| Quantity of U.S. Visas Granted | total number of visas issued for a given type and year                                  | U.S. State Department |
| Population                     | quantity of people living in a given geographic area                                    | U.S. Census Bureau    |
| GDP                            | Gross Domestic Product measured in current U.S. dollars                                 | U.S. Census Bureau    |
| Annual Growth Rate             | annual percent change in population, accounting for natural increase and net migration  | World Bank            |
| Rate of Natural Increase       | percent difference between the crude birth rate and the crude death rate                | U.S. Census Bureau    |
| Population Density             | total population of a geographic area divided by its land area in square kilometers     | U.S. Census Bureau    |
| Crude Birth Rate               | avg. annual number of births during a year per 1,000 population at midyear              | U.S. Census Bureau    |
| Net International Migrants     | number of immigrants minus the number of emigrants, including citizens and non-citizens | U.S. Census Bureau    |

## Analytical Approach

To analyze the data, we employed a visualization-driven methodology to explore trends, patterns, and relationships. Visualization techniques, such as interactive maps, bar charts, and scatterplots, provided intuitive insights into how U.S. visa issuance aligns with economic and demographic indicators.

By leveraging data visualization, we identified trends and formulated hypotheses. This approach enabled us to present complex data in an accessible manner, uncovering insights into how economic indicators and policy shifts shape U.S. visa issuance strategies.

<h1 style="text-align: center;">Exploratory Analysis</h1> 

```{r fig.width=12, fig.height=6, echo=FALSE, warning=FALSE}
# Define presidential administration transition years 
key_events <- c(2001, 2009, 2015, 2020)  # Adjust these as per your dataset

# Aggregate data by Fiscal Year and Visa Category, converting Total_Visas to units of 1000 
aggregated_data <- analysis_data %>% 
  group_by(`Fiscal Year`, `Visa Category`) %>% 
  summarise(Total_Visas = sum(`Quantity of U.S. Visas Granted`) / 1000, .groups = 'drop')  # Convert to thousands

# Custom color scheme for visa categories 
visa_colors <- c( 
  "Skilled Labor Visas" = "#F84947",  # Red 
  "Unskilled Labor Visas" = "#F1C40F",  # Golden Yellow 
  "Student and Exchange Visitor Visas" = "#5794D4"  # Blue 
)

# Create the stacked area chart with vertical indicators for presidential transitions 
ggplot(aggregated_data, aes(x = `Fiscal Year`, y = Total_Visas, fill = `Visa Category`)) + 
  geom_area() +  # Stacked area chart 
  geom_vline(xintercept = key_events, linetype = "dashed", color = "gray") + 
  scale_fill_manual(values = visa_colors) +  # Apply custom colors 
  labs(
    title = "Shifting Borders: The Impact of U.S. Political Events on Visa Issuance Trends", 
    x = "Fiscal Year", 
    y = "Total Quantity of Visas (in thousands)", 
    fill = "Visa Category" 
  ) + 
  theme_minimal() +  # Minimal theme for a clean look 
  theme(
    text = element_text(size = 12, family = "Futura"),  # Set font family to Futura 
    legend.position = "right",  # Position the legend on the right 
    plot.title = element_text(hjust = 0.5, family = "Futura", size = 16, margin = margin(b = 15)),  # Title customization 
    axis.title = element_text(family = "Futura"),  # Axis labels in Futura 
    axis.text = element_text(family = "Futura"),  # Axis text in Futura 
    legend.title = element_text(family = "Futura"),  # Legend title in Futura 
    legend.title.align = 0.5  # Center the legend title 
  ) + 
  # Add key event labels with adjustments for better visibility 
  annotate("text", x = key_events, y = Inf, label = c("9/11 Attack", "Great Recession", "Rep. Control of Congress", "COVID Pandemic"), 
           angle = 90, vjust = 1.5, hjust = 1, color = "black", size = 3, family = "Futura")
```

```{r fig.width=12, fig.height=6, echo=FALSE, warning=FALSE}
# Define presidential administration transition years
transition_years <- c(2001, 2009, 2017, 2021)  # Years of presidential transitions

# Aggregate data by Fiscal Year and Visa Category, converting Total_Visas to units of 1000
aggregated_data <- analysis_data %>%
  group_by(`Fiscal Year`, `Visa Category`) %>%
  summarise(Total_Visas = sum(`Quantity of U.S. Visas Granted`) / 1000, .groups = 'drop')  # Convert to thousands

# Custom color scheme for visa categories
visa_colors <- c(
  "Skilled Labor Visas" = "#F84947",  # Red for Skilled Labor Visas
  "Unskilled Labor Visas" = "#F1C40F",  # Golden Yellow for Unskilled Labor Visas
  "Student and Exchange Visitor Visas" = "#5794D4"  # Blue for Student and Exchange Visitor Visas
)

# Create the line chart with vertical indicators for presidential transitions
ggplot(aggregated_data, aes(x = `Fiscal Year`, y = Total_Visas, color = `Visa Category`, group = `Visa Category`)) + 
  geom_line(size = 1) + 
  geom_vline(xintercept = transition_years, linetype = "dashed", color = "gray") + 
  scale_color_manual(values = visa_colors) + 
  labs( 
    title = "From Bush to Biden: How Presidential Administrations Impact Types U.S. Visas Issued", 
    x = "Fiscal Year", 
    y = "Total Quantity of Visas (in thousands)", 
    color = "Visa Category" 
  ) + 
  theme_minimal() + 
  theme( 
    text = element_text(size = 12, family = "Futura"),  # Font family: Futura 
    legend.position = "right",  # Place the legend on the right 
    plot.title = element_text(hjust = 0.5, family = "Futura", size = 16, margin = margin(b = 15)),
    axis.title = element_text(family = "Futura"),  # Axis labels in Futura font 
    axis.text = element_text(family = "Futura"),  # Axis text in Futura font 
    legend.title = element_text(family = "Futura"),  # Legend title in Futura 
    legend.title.align = 0.5  # Center the legend title 
  ) + 
  annotate("text", x = transition_years, y = Inf, label = c("Bush", "Obama", "Trump", "Biden"), 
           angle = 90, vjust = 1.5, hjust = 1, color = "black", size = 4, family = "Futura")
```

```{r echo=FALSE, warning=FALSE}

plot_top_5_visas <- function(visa_category, scale_type = "log") {
  # Filter data for the specific visa category
  df_category <- analysis_data %>%
    filter(`Visa Category` == visa_category)
  
  # Get the top 5 countries by the total number of visas granted
  top_5_countries <- df_category %>%
    group_by(Country) %>%
    summarise(total_visas = sum(`Quantity of U.S. Visas Granted`, na.rm = TRUE), .groups = "drop") %>%
    top_n(5, total_visas) %>%
    pull(Country)
  
  # Filter data for the top 5 countries
  df_top_5 <- df_category %>%
    filter(Country %in% top_5_countries)
  
  # Summarize the total number of visas per year for these countries
  df_summary <- df_top_5 %>%
    group_by(`Fiscal Year`, Country) %>%
    summarise(total_visas = sum(`Quantity of U.S. Visas Granted`, na.rm = TRUE), .groups = "drop")
  
  # Generate the graph
  plot <- ggplot(df_summary, aes(x = `Fiscal Year`, y = total_visas, color = Country)) +
    geom_line(size = 1) +
    labs(title = paste("Top 5 Countries with Most", visa_category, "by Year"),
         x = "Year",
         y = "Total Number of Visas (Log Scale)") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    scale_color_brewer(palette = "Set3") +
    theme_minimal() +
    theme(legend.title = element_blank())
  
  # Apply log scale to the y-axis
  plot <- plot + scale_y_log10()
  
  # Return the plot
  return(plot)
}

# Generate and display the graphs for all visa categories with log scale
plot_top_5_visas("Skilled Labor Visas", scale_type = "log")

```

```{r echo=FALSE, warning=FALSE}
plot_top_5_visas("Unskilled Labor Visas", scale_type = "log")
```

```{r echo=FALSE, warning=FALSE}
plot_top_5_visas("Student and Exchange Visitor Visas", scale_type = "log")

```

```{r echo=FALSE, warning=FALSE}
# Check column names to ensure correct referencing
print(colnames(analysis_data))

# Aggregate data
pop_growth <- analysis_data %>%
  group_by(Country, `Fiscal Year`) %>%
  summarise(Population = sum(Population, na.rm = TRUE), .groups = 'drop')

visa_distribution <- analysis_data %>%
  group_by(Country, `Fiscal Year`, `Visa Category`) %>%
  summarise(Total.Visas = sum(`Quantity of U.S. Visas Granted`, na.rm = TRUE), .groups = 'drop')

# Identify top 5 countries by total visa issuances
top_countries <- visa_distribution %>%
  group_by(Country) %>%
  summarise(Total.Visas = sum(Total.Visas), .groups = 'drop') %>%
  slice_max(Total.Visas, n = 5) %>%
  pull(Country)

# Filter for top countries
filtered_data <- visa_distribution %>%
  filter(Country %in% top_countries)

# Plot stacked bar chart
p <- ggplot(filtered_data, aes(x = `Fiscal Year`, y = Total.Visas, fill = `Visa Category`)) +
  geom_bar(stat = 'identity', position = 'stack') +
  
  labs(
    title = 'Visa Issuance Trends for Top 5 Countries',
    subtitle = 'Stacked bar plot by visa category over the years',
    x = 'Fiscal Year',
    y = 'Total Visas Issued',
    fill = 'Visa Category'
  ) +
  facet_wrap(~ Country, scales = 'free_y', nrow = 2) +
  scale_fill_brewer(palette = 'Set2') +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
    axis.text.y = element_text(size = 10),
    strip.text = element_text(size = 10, face = 'bold'),
    plot.title = element_text(hjust = 0.5, size = 18, face = 'bold'),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    legend.position = 'top',
    legend.title = element_text(size = 13),
    legend.text = element_text(size = 11),
    plot.margin = margin(15, 15, 15, 15),
    aspect.ratio = 1.3  # Increase the height further
  )

print(p)
```

<h1 style="text-align: center;">Conclusion</h1> 


<h1 style="text-align: center;">Works Cited</h1> 

-   <https://www.dol.gov/agencies/whd/immigration/h1b>

-   <https://ccis.ucsd.edu/_files/wp11.pdf>

-   <https://www.migrationpolicy.org/article/h-1b-temporary-skilled-worker-program>

-   <https://timelines.issarice.com/wiki/Timeline_of_student_visa_policy_in_the_United_States>

-   <https://www.thecrimson.com/article/2020/12/11/trump-immigration-higher-education/>

-   <https://www.americanimmigrationcouncil.org/research/h1b-visa-program-fact-sheet>

-   Migration Policy Institute. [Migration Policy Institute Website](https://www.migrationpolicy.org/)

-   Preston, S., & Elo, I. (1995). *Demography: Analysis of Mortality and Fertility Rates*. [DOI: 10.1016/S0304-3932(02)00206-4](https://doi.org/10.1016/S0304-3932(02)00206-4).
