---
title: "Project 1"
author: "Anna Brown, Rishika Deshmukh, and Ada Zhang"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true        # Enable the Table of Contents
    toc_depth: 3     # Set the depth of headings included in the TOC
    toc_float: true  # Enable floating TOC (keeps TOC fixed as you scroll)
    code_folding: none
    self_contained: false
    css: "styles.css"  # Link to an external stylesheet
---

```{r echo=FALSE, warning=FALSE, message=FALSE, results="hide"}
# Function to check and install missing packages
install_if_missing <- function(package) {
  if (!require(package, character.only = TRUE)) {
    install.packages(package, dependencies = TRUE)
    library(package, character.only = TRUE)
  }
}

# List of required packages
packages <- c(
  "countrycode", "dplyr", "DT", "ggplot2", "leaflet", 
  "maps", "patchwork", "readr", "rworldmap", "showtext", 
  "sp", "tidyverse"
)

# Ensure all packages are installed and loaded
lapply(packages, install_if_missing)

# Load libraries explicitly
library(countrycode)
library(dplyr)
library(DT)
library(ggplot2)
library(leaflet)
library(maps)
library(patchwork)
library(readr)
library(rworldmap)
library(showtext)
library(sp)
library(tidyverse)

# Set the file path
url <- "https://raw.githubusercontent.com/annab0503/DS4002/main/Project%201/Analysis%20Data/analysis_data.csv"

# Read the CSV file from the URL
analysis_data <- read_csv(url)

# Enable the showtext package
showtext_auto()

# Add Google Fonts
font_add_google("Bodoni Moda", "bodoni_moda")  # Alias: bodoni_moda
font_add_google("Montserrat", "montserrat")     # Alias: montserrat
```

```{r eval=FALSE, include=FALSE}
# Load the Dataset from URL
data <- analysis_data

# Loop Through Years from 1997 to 2022
for (selected_year in 1997:2022) {

  # Filter and Aggregate Visa Data by Country and Year
  visa_data <- data %>%
    filter(`Fiscal.Year` == selected_year) %>%
    group_by(Country) %>%
    summarise(visas_issued = sum(`Quantity.of.U.S..Visas.Granted`, na.rm = TRUE)) %>%
    ungroup()

  if (nrow(visa_data) == 0) {
    message(paste("No data available for the fiscal year", selected_year))
    next
  }

  # Map Visa Data to World Map
  world_map <- joinCountryData2Map(
    visa_data,
    joinCode = "NAME",
    nameJoinColumn = "Country"
  )

  if (is.null(world_map)) {
    message("Country matching failed. Check for inconsistencies in country names.")
    next
  }

  # Plot the Heat Map
  breaks <- pretty(visa_data$visas_issued, n = 6)

  # Ensure unique breaks for the plot
  if (length(unique(breaks)) < 2) {
    breaks <- unique(c(breaks, max(breaks) + 1))
  }

  mapCountryData(
    world_map,
    nameColumnToPlot = "visas_issued",
    catMethod = breaks,
    mapTitle = paste("Visa Issuance Heat Map for Fiscal Year", selected_year),
    colourPalette = "heat",
    missingCountryCol = gray(0.8),
    addLegend = TRUE
  )
}

png(paste0("visa_heatmap_fy", selected_year, ".png"), width = 1200, height = 900)
  mapCountryData(
    world_map,
    nameColumnToPlot = "visas_issued",
    catMethod = breaks,
    mapTitle = paste("Visa Issuance Heat Map for Fiscal Year", selected_year),
    colourPalette = "heat",
    missingCountryCol = gray(0.8),
    addLegend = TRUE
  )
  dev.off()
```

```{r graph, echo=FALSE, fig.cap="Visa Issuances Heatmap 1997-2022", out.width = '100%'}
knitr::include_graphics("visa_heatmap.gif")
```

# **Introduction**

**What drives U.S. visa issuance?** Every year, millions of individuals from around the world apply for U.S. visas. Each application represents a unique story of aspiration, opportunity, and global connection. But behind these personal journeys lies a complex system, shaped by economic realities, shifting policies, and demographic trends. So, what determines who gets to cross U.S. borders?

Among the many U.S. visa categories, three key types most closely tied to economic outcomes are the focus of this analysis:

- **Student and Exchange Visitor Visas**: Fostering human capital development (e.g., F-1 for academic students, J-1 for exchange visitors, and M-1 for vocational students).  
- **Skilled Labor Visas**: Supplying specialized expertise (e.g., H-1B for specialty workers, L-1 for intra-company transferees, and O-1 for extraordinary ability individuals).  
- **Unskilled Labor Visas**: Supporting essential workforce needs (e.g., H-2A for agricultural workers and H-2B for temporary non-agricultural workers).

From a student in India hoping to study in the U.S. to a tech professional in Brazil seeking an H-1B visa, each immigrant’s story reflects the intricate relationship between global economic shifts and U.S. immigration policies. This study explores how economic indicators, government decisions, and labor market needs shape visa issuance trends, asking:

- **How do U.S. policies under different administrations impact visa issuance?**
- **What role do foreign GDP levels play in U.S. visa trends?**
- **How do population growth and migration patterns shape the flow of visa applicants?**

By examining these factors, this analysis seeks to offer insights into how the U.S. adapts its visa strategies in response to domestic and global economic shifts, highlighting the evolving nature of immigration policy.

# **Background**

## Skilled Labor Visas  

The **H-1B visa** is the most prominent skilled labor visa, allowing U.S. employers to hire highly skilled foreign professionals for specialty occupations requiring advanced knowledge and at least a bachelor’s degree or its equivalent. Over the years, the H-1B program has been influenced by economic and political factors. For instance, in 1998, high-tech industry lobbying led to proposals to increase the H-1B visa cap, citing a significant unmet demand for skilled workers. In response, the **American Competitiveness in the 21st Century Act** temporarily raised the cap to 195,000 between 2001 and 2003, before reverting to 65,000 in 2004. The 2008 recession brought further scrutiny, with Congress targeting the program to protect domestic jobs, resulting in a decline in filed petitions. These fluctuations underscore the program’s sensitivity to broader economic conditions and labor market demands.  

## Student and Exchange Visitor Visas

Visas such as the **F-1, J-1,** and **M-1** facilitate international education and cultural exchange in the U.S., playing a key role in human capital development. Policies have evolved over time to ensure better regulation and monitoring of international students. For example, the 1996 **Illegal Immigration Reform and Immigrant Responsibility Act** (IIRIRA) introduced measures to track foreign students, while the 2003 implementation of the **Student and Exchange Visitor Information System** (SEVIS) improved monitoring capabilities. Under the Obama administration, the federal **Optional Practical Training (OPT)** program was expanded for STEM students, reflecting the importance of international talent in innovation and research. However, the Trump administration tightened F-1 visa regulations, proposing fixed-term policies and stricter evaluations, highlighting how political priorities influence visa policies.  

## Unskilled Labor Visas

Unskilled labor visas, including the **H-2A** and **H-2B**, address the demand for temporary agricultural and non-agricultural labor, respectively. The H-2A visa supports agricultural operations during peak seasons, ensuring labor availability for tasks such as planting and harvesting, while the H-2B visa fills gaps in industries like hospitality, construction, and landscaping. These visas are crucial for industries reliant on seasonal or peak-period labor, reflecting the essential role of temporary workers in maintaining economic stability in key sectors.  

## Economic Perspectives on Foreign Workers

Economic discussions about foreign workers revolve around their contributions to growth and innovation as well as concerns about their impact on the domestic labor market. Proponents argue that foreign workers fill critical labor shortages, enhance innovation, and sustain industries with fluctuating labor demands. For example, H-1B visa holders are often associated with technological advancements, patents, and entrepreneurial activities that drive competitiveness. Similarly, unskilled labor visas ensure the stability of sectors like agriculture and tourism, which are vital to the U.S. economy.  

Critics, however, caution against potential wage suppression and increased competition for domestic workers, emphasizing the need for careful policy design to ensure equitable benefits. This research delves into these dynamics, examining how U.S. visa policies reflect broader economic priorities and labor market realities while balancing domestic interests with international interdependence.

# **Methodology**

## Data Sources

Our analysis draws on three primary data sources (originally accessed on January 2, 2025), each providing unique insights into visa trends and the broader economic landscape:

<div class="btn-container"> [U.S. State Department](https://travel.state.gov/content/travel/en/legal/visa-law0/visa-statistics/nonimmigrant-visa-statistics.html){.btn .btn-primary}
</div>

The U.S. State Department's visa statistics offer comprehensive data on nonimmigrant visas issued by the U.S. government, including details on visa types and countries of origin. This dataset can be segmented by visa categories, geographic regions, and other criteria, making it a valuable resource for researchers and policymakers. It is commonly used to analyze trends in U.S. immigration, such as changes in the number of visas issued to foreign nationals over time. Organizations like the U.S. Department of Homeland Security and the Migration Policy Institute (MPI) utilize this data to evaluate the effects of visa policy changes. For example, MPI assesses how shifts in U.S. visa issuance impact international student enrollment trends at U.S. universities.

<div class="btn-container"> [World Bank](https://wits.worldbank.org/CountryProfile/en/country/by-country/startyear/ltst/endyear/ltst/indicator/NY-GDP-MKTP-CD#){.btn .btn-primary} </div>

The World Bank dataset highlights country-level economic indicators, with a focus on Gross Domestic Product (GDP) measured in current US dollars. Through the World Integrated Trade Solution platform, the World Bank provides access to an extensive range of economic, trade, and development data, including GDP figures for all countries. This data is widely used to forecast global economic trends, such as those presented in the World Economic Outlook, which guides the economic policies of member countries. Cross-country GDP comparisons are essential for analyzing global disparities in development. For instance, Dollar and Kraay (2003) used World Bank GDP data to demonstrate a direct correlation between economic growth and poverty reduction in developing nations.

<div class="btn-container"> [U.S. Census Bureau](https://www.census.gov/data-tools/demo/idb/#/table?dashboard_page=country&COUNTRY_YR_ANIM=2025&menu=tableViz&quickReports=CUSTOM&CUSTOM_COLS=POP,GR,RNI,POP_DENS,CBR,CDR,NMR,NIM&TABLE_RANGE=1997,2014&TABLE_YEARS=1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2025&TABLE_USE_RANGE=Y&TABLE_USE_YEARS=Y&TABLE_STEP=1&TABLE_ADD_YEARS=2025){.btn .btn-primary} </div>

The U.S. Census Bureau's International Data Base (IDB) provides demographic information for countries worldwide, including population size, growth rates, fertility and mortality rates, life expectancy, and migration patterns. Covering multiple decades and regularly updated, the IDB is a key resource for analyzing global population trends and forecasting demographic shifts. Researchers use it to examine population growth and its implications for urbanization, labor markets, and social services, offering insights into the challenges faced by countries with rapidly growing populations.

## Data Cleaning and Integration

To ensure accuracy and compatibility, we executed a rigorous data-cleaning process in Python using a Jupyter Notebook. This process involved:

- **Standardizing Variables**: Key variables such as country names were standardized across datasets to ensure consistency.
- **Handling Missing Data**: Missing values were identified and treated based on the nature of the variable, employing methods such as imputation or exclusion where appropriate.
- **Merging Datasets**: The cleaned datasets were integrated into a unified dataframe using shared keys like country and fiscal year, allowing for seamless analysis across multiple dimensions.
- **Validation**: Cross-referencing with original sources ensured the accuracy of merged data and derived variables.

Detailed replication documents, including the Python code used for cleaning and merging, are available in our [GitHub repository](https://github.com/annab0503/DS4002/blob/main/Project%201/Analysis%20Data/replication_document.ipynb).

## Variables for Analysis

Our cleaned dataset includes the following variables, each essential for addressing our research questions:

| Variable                       | Description                                                                             | Source                |
|--------------------------------|-----------------------------------------------------------------------------------------|-----------------------|
| Country                        | geographic entity of interest                                                           | All                   |
| Fiscal Year                    | year for which data is reported, based on the U.S. fiscal calendar                      | All                   |
| Visa Category                  | classification of U.S. visas issued (e.g., unskilled labor, skilled labor, student)     | U.S. State Department |
| Quantity of U.S. Visas Granted | total number of visas issued for a given type and year                                  | U.S. State Department |
| Population                     | quantity of people living in a given geographic area                                    | U.S. Census Bureau    |
| GDP                            | Gross Domestic Product measured in current U.S. dollars                                 | U.S. Census Bureau    |
| Annual Growth Rate             | annual percent change in population, accounting for natural increase and net migration  | World Bank            |
| Rate of Natural Increase       | percent difference between the crude birth rate and the crude death rate                | U.S. Census Bureau    |
| Population Density             | total population of a geographic area divided by its land area in square kilometers     | U.S. Census Bureau    |
| Crude Birth Rate               | avg. annual number of births during a year per 1,000 population at midyear              | U.S. Census Bureau    |
| Net International Migrants     | number of immigrants minus the number of emigrants, including citizens and non-citizens | U.S. Census Bureau    |

## Analytical Approach

To analyze the data, we employed a visualization-driven methodology to explore trends, patterns, and relationships. Visualization techniques, such as interactive maps, bar charts, and scatterplots, provided intuitive insights into how U.S. visa issuance aligns with economic and demographic indicators.

By leveraging data visualization, we identified trends and formulated hypotheses. This approach enabled us to present complex data in an accessible manner, uncovering insights into how economic indicators and policy shifts shape U.S. visa issuance strategies.

# **Exploratory Analysis**

To identify the factors that shape U.S. immigration policy, we began our analysis by examining the overarching trends in U.S. visa allocation. The stacked bar below highlights a steady increase in the total number of visas issued over the past two decades, reflecting a long-term growth trend. However, this visualization also reveals two distinct periods of decline, beginning in 2001 and 2005, as well as two singular years of sharp drops in 2008 and 2020.

```{r fig.width=12, fig.height=6, echo=FALSE, warning=FALSE}
# Define key transition years in U.S. presidential administrations
key_events <- c(2001, 2008, 2015, 2020)  # Adjust these as per your dataset

# Aggregate data by Fiscal Year and Visa Category
# The 'Quantity of U.S. Visas Granted' is summed and converted to thousands for clarity
aggregated_data <- analysis_data %>% 
  group_by(`Fiscal Year`, `Visa Category`) %>%  # Group the data by fiscal year and visa category
  summarise(Total_Visas = sum(`Quantity of U.S. Visas Granted`) / 1000, .groups = 'drop')  # Sum the visa quantities and convert to thousands

# Custom color scheme for the different visa categories
visa_colors <- c( 
  "Skilled Labor Visas" = "#F84947",  # Red for skilled labor visas
  "Unskilled Labor Visas" = "#F1C40F",  # Golden yellow for unskilled labor visas
  "Student and Exchange Visitor Visas" = "#5794D4"  # Blue for student and exchange visitor visas
)

# Create the stacked area chart, using the aggregated data and applying visual customization
ggplot(aggregated_data, aes(x = `Fiscal Year`, y = Total_Visas, fill = `Visa Category`)) + 
  geom_area() +  # Generate the stacked area chart to visualize the total visas over time
  geom_vline(xintercept = key_events, linetype = "dashed", color = "gray") +  # Add vertical dashed lines at key event years
  scale_fill_manual(values = visa_colors) +  # Apply the custom color scheme for visa categories
  labs(
    title = "Shifting Borders: The Impact of U.S. Political Events on Visa Issuance Trends",  # Main title of the plot
    x = "Fiscal Year",  # X-axis label
    y = "Total Quantity of Visas (in thousands)",  # Y-axis label
    fill = "Visa Category"  # Label for the legend
  ) + 
  theme_minimal() +  # Apply a minimal theme for a clean, simple appearance
  theme(
    # Customize the primary title
    plot.title = element_text(hjust = 0.5, family = "bodoni_moda", size = 16, margin = margin(b = 15), face = "bold"),  
    # The title is centered (hjust = 0.5), set to Bodoni Moda font with size 16, and a margin at the bottom for spacing
    
    # Customize the legend title
    legend.title = element_text(family = "bodoni_moda", size = 13, face = "bold"),  # Set the legend title font to Bodoni Moda with size 13
    
    # Customize the axis labels and axis text
    axis.title = element_text(family = "montserrat", size = 14),  # Set axis titles (x and y) to use Montserrat font with size 14
    axis.text = element_text(family = "montserrat", size = 12),  # Set axis text (the numbers) to use Montserrat font with size 12
    
    # Apply Montserrat font for all other text elements in the plot
    text = element_text(size = 12, family = "montserrat"),  # Set the default font for text elements to Montserrat with size 12
    
    # Position the legend on the right side of the plot
    legend.position = "right",  # Position the legend to the right
    
    # Align the legend title to the center
    legend.title.align = 0.5  # Center the legend title text
  ) + 
  # Add labels for key events, positioning the labels at the top of the plot
  annotate("text", x = key_events, y = Inf, label = c("9/11 Attack", "Great Recession", "Rep. Control of Congress", "COVID Pandemic"), 
           angle = 90, vjust = 1.5, hjust = 1, color = "black", size = 3, family = "bontserrat")  # Annotate the key events with rotated text
```

Interestingly, the two sustained downturns in visa issuance align with significant political shifts in the U.S., potentially influencing immigration policies. Following the terrorist attacks on September 11, 2001, Congress enacted the Enhanced Border Security and Visa Entry Reform Act of 2002, introducing stricter visa processing requirements and heightened security measures that contributed to the first prolonged decline. Similarly, the political realignment after the 2014 elections, which gave Republicans control of both the Senate and the House for the first time since the 109th Congress, likely played a role in the second period of sustained decline. With the largest Republican majority since 1929–1931, this Congress prioritized enforcement-focused immigration policies, which may have impacted visa issuance trends from 2015 to 2019. These political shifts raise our first question: **How do U.S. policies under different administrations impact visa issuance?**

In contrast, the sharp declines in 2008 and 2020 appear to be driven more by significant economic disruptions than by political changes. The global financial crisis of 2008, for example, reduced both the demand for labor migration and immigrants' financial capacity to move, which likely contributed to the modest yet noticeable downturn in visa numbers. Similarly, the COVID-19 pandemic in 2020 caused an even more pronounced collapse, as global mobility was severely disrupted. The economic uncertainty brought on by the pandemic, including widespread job losses and disruptions to international trade, likely exacerbated the decline in visa issuance, as both potential migrants and employers faced financial instability and reduced capacity for mobility. These economic factors prompt our second question: **What role do foreign GDP levels play in U.S. visa trends?**

Additionally, the variations in visa types during these periods suggest that demographic shifts could be influencing both the quantity and categories of visas sought. This observation raises our third question: **How do population growth and migration patterns shape the flow of visa applicants?** 

These questions drive our deeper analysis, as we aim to understand how the interplay of policy decisions, economic conditions, and demographic changes has shaped U.S. immigration patterns.

## How do U.S. policies under different administrations influence visa issuance trends?

```{r fig.width=12, fig.height=6, echo=FALSE, warning=FALSE}
# Define presidential administration transition years
transition_years <- c(2001, 2009, 2017, 2021)  # Years of presidential transitions

# Aggregate data by Fiscal Year and Visa Category
# The 'Quantity of U.S. Visas Granted' is summed and converted to thousands for clarity
aggregated_data <- analysis_data %>% 
  group_by(`Fiscal Year`, `Visa Category`) %>%  # Group the data by fiscal year and visa category
  summarise(Total_Visas = sum(`Quantity of U.S. Visas Granted`) / 1000, .groups = 'drop')  # Sum the visa quantities and convert to thousands

# Custom color scheme for the different visa categories
visa_colors <- c(
  "Skilled Labor Visas" = "#F84947",  # Red for Skilled Labor Visas
  "Unskilled Labor Visas" = "#F1C40F",  # Golden Yellow for Unskilled Labor Visas
  "Student and Exchange Visitor Visas" = "#5794D4"  # Blue for Student and Exchange Visitor Visas
)

# Create the line chart, using the aggregated data and applying visual customization
ggplot(aggregated_data, aes(x = `Fiscal Year`, y = Total_Visas, color = `Visa Category`, group = `Visa Category`)) +
  geom_line(size = 1) +  # Draw the line chart with a line thickness of 1
  geom_vline(xintercept = transition_years, linetype = "dashed", color = "gray") +  # Add vertical dashed lines at the transition years
  scale_color_manual(values = visa_colors) +  # Apply the custom color scheme for visa categories
  labs(
    title = "From Bush to Biden: How Presidential Administrations Impact Types U.S. Visas Issued",  # Main title of the plot
    x = "Fiscal Year",  # X-axis label
    y = "Total Quantity of Visas (in thousands)",  # Y-axis label
    color = "Visa Category"  # Label for the legend
  ) +
  theme_minimal() +  # Apply a minimal theme for a clean, simple appearance
  theme(
    # Customize the primary title
    plot.title = element_text(hjust = 0.5, family = "bodoni_moda", size = 16, margin = margin(b = 15), face = "bold"),  # Title is centered (hjust = 0.5), uses Bodoni Moda font, size 16, and a bottom margin for spacing

    # Customize the legend title
    legend.title = element_text(family = "bodoni_moda", size = 13, face = "bold"),  # Legend title font set to Bodoni Moda, size 13

    # Customize the axis labels and axis text
    axis.title = element_text(family = "montserrat", size = 14),  # Axis titles (x and y) use Montserrat font, size 14
    axis.text = element_text(family = "montserrat", size = 12),  # Axis text (the numbers) use Montserrat font, size 12

    # Apply Montserrat font for all other text elements in the plot
    text = element_text(size = 12, family = "montserrat"),  # Default font for text elements set to Montserrat, size 12

    # Position the legend on the right side of the plot
    legend.position = "right",  # Legend positioned on the right

    # Align the legend title to the center
    legend.title.align = 0.5  # Center-align legend title text
  ) +
  # Add labels for key events, positioning the labels at the top of the plot
  annotate("text", x = transition_years, y = Inf, label = c("Bush", "Obama", "Trump", "Biden"),
           angle = 90, vjust = 1.5, hjust = 1, color = "black", size = 4, family = "montserrat")  # Annotate key events with rotated text in Montserrat font
```

## What is the relationship between foreign GDP levels and U.S. visa issuance?

```{r fig.width=10, fig.height=6, echo=FALSE, warning=FALSE}
plot_visa_per_capita_vs_gdp <- function(visa_category) {
  # Filter the data for the selected visa category
  df_category <- analysis_data %>%
    filter(`Visa Category` == visa_category)
  
  # Identify the top 5 countries by total visas granted
  top_5_countries <- df_category %>%
    group_by(Country) %>%
    summarise(total_visas = sum(`Quantity of U.S. Visas Granted`, na.rm = TRUE), .groups = "drop") %>%
    top_n(5, total_visas) %>%
    pull(Country)
  
  # Filter for the top 5 countries and calculate Visa per Capita and GDP per Capita
  df_top_5 <- df_category %>%
    filter(Country %in% top_5_countries) %>%
    mutate(
      Visa_per_Capita = `Quantity of U.S. Visas Granted` / `Population`,
      GDP_per_Capita = `GDP` / `Population`
    )
  
  # Create the plot
  plot <- ggplot(df_top_5, aes(x = GDP_per_Capita, y = Visa_per_Capita, color = Country)) +
    geom_point(size = 3) +
    labs(
      title = paste("Visa per Capita vs GDP per Capita for", visa_category),
      x = "GDP per Capita (USD)",
      y = "Visa per Capita",
      color = "Country"
    ) +
    theme_minimal() +
    theme(
      # Customize the primary title
      plot.title = element_text(hjust = 0.5, family = "bodoni_moda", size = 16, margin = margin(b = 15), face = "bold"),
      
      # Customize the legend title
      legend.title = element_text(family = "bodoni_moda", size = 13, face = "bold"),
      
      # Customize the axis labels and axis text
      axis.title = element_text(family = "montserrat", size = 14),
      axis.text = element_text(family = "montserrat", size = 12),
      
      # Apply Montserrat font for all other text elements in the plot
      text = element_text(size = 12, family = "montserrat"),
      
      # Position the legend on the right side of the plot
      legend.position = "right",
      
      # Align the legend title to the center
      legend.title.align = 0.5,
      
      # Customize x-axis text to angle for readability
      axis.text.x = element_text(angle = 45, hjust = 1)
    ) +
    scale_color_manual(values = c("#F84947", "#5794D4","#F1C40F", "#A93226", "#092E86"))  # Adjust colors for top countries
  
  return(plot)
}

# Generate and display the plots for a specific visa category
plot_visa_per_capita_vs_gdp("Skilled Labor Visas")
```

Countries like China, India, and Mexico, which have lower GDP per capita, issue fewer skilled labor visas. This might mean they rely more on their own skilled workers instead of sending them to the U.S. On the other hand, the UK, with a high GDP per capita, issues more skilled labor visas, showing its economy depends on foreign talent for specialized industries. Japan, even though it has a high GDP, issues fewer skilled visas, possibly due to stricter immigration rules or a preference for local workers. This shows that skilled visa numbers may depend on a country’s workforce needs and policies more than just GDP

```{r fig.width=10, fig.height=6, echo=FALSE, warning=FALSE}
plot_visa_per_capita_vs_gdp("Unskilled Labor Visas")
```

Jamaica, which has a low GDP per capita, sends a small but steady number of unskilled workers to the U.S. Countries like South Africa and Guatemala are similar but issue even fewer visas, which could mean fewer opportunities or challenges in migrating. Mexico, with a slightly higher GDP, issues more unskilled labor visas, probably because of its close location to the U.S. The UK, with a high GDP, hardly issues any unskilled visas, focusing more on skilled workers instead. This shows unskilled visa numbers are often influenced by geography and job opportunities more than just GDP.


```{r fig.width=10, fig.height=6, echo=FALSE, warning=FALSE}
plot_visa_per_capita_vs_gdp("Student and Exchange Visitor Visas")
```
China and India, with their large populations and growing middle class, send large numbers of students abroad despite their relatively lower GDP per capita. This reflects the increasing demand for higher education and global opportunities. South Korea shows a varied pattern, with a significant number of students leaving for education, which may be attributed to a highly educated population and a strong focus on international exposure. Germany and Japan, despite having high GDP per capita, still show substantial student visa trends, indicating the international appeal of their education systems. Both countries have well-established research and academic institutions that attract students from around the world.

## How do population growth and migration patterns affect visa issuance?

Ada's section
```{r, echo=FALSE}
plot_visa_per_capita_vs_gdp("Student and Exchange Visitor Visas")
```

China and India send a lot of students to the U.S. for education, even though their GDP per capita is lower. This reflects the growing middle class in these countries and the value they place on higher education abroad. South Korea also has strong student visa numbers, which might be due to its focus on international education. Germany and Japan, with high GDP per capita, also send many students, likely because of the appeal of international degrees and their ability to afford it. Student visa trends seem to depend more on education goals and opportunities more than just GDP.

## How do population growth and migration patterns affect visa issuance?

By examining U.S. visa issuance trends alongside population growth, we can identify significant drivers behind migration patterns from the top five countries—China, India, Japan, South Korea, and Mexico.

Ada's section


```{r echo=FALSE}
library(tidyr)
library(dplyr)
library(ggplot2)

# Aggregate data for visa distribution
visa_distribution <- analysis_data %>%
  group_by(Country, `Fiscal Year`, `Visa Category`) %>%
  summarise(Total.Visas = sum(`Quantity of U.S. Visas Granted`, na.rm = TRUE), .groups = 'drop')

# Identify top 5 countries by total visa issuances
top_countries <- visa_distribution %>%
  group_by(Country) %>%
  summarise(Total.Visas = sum(Total.Visas), .groups = 'drop') %>%
  slice_max(Total.Visas, n = 5) %>%
  pull(Country)

# Filter for top countries
filtered_data <- visa_distribution %>%
  filter(Country %in% top_countries)

# Plot stacked bar chart for visa issuance
p <- ggplot(filtered_data, aes(x = `Fiscal Year`, y = Total.Visas, fill = `Visa Category`)) +
  
  # Stacked bar for visas
  geom_bar(stat = 'identity', position = 'stack') +
  
  # Labels and Titles
  labs(
    title = 'Visa Issuance Trends for Top 5 Countries',
    subtitle = 'Stacked bar plot by visa category over the years',
    x = 'Fiscal Year',
    y = 'Total Visas Issued',
    fill = 'Visa Category'
  ) +
  
  # Facet by country to show trends
  facet_wrap(~ Country, nrow = 1) +
  
  # Customize colors and themes
  scale_fill_brewer(palette = 'Set2') +
  theme_minimal(base_size = 14) +
  
  # Improve axis and text aesthetics
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
    axis.text.y = element_text(size = 10),
    strip.text = element_text(size = 10, face = 'bold'),
    plot.title = element_text(hjust = 0.5, size = 15, face = 'bold'),
    plot.subtitle = element_text(hjust = 0.5, size = 10),
    legend.position = 'top',
    legend.title = element_text(size = 10),
    legend.text = element_text(size = 10),
    plot.margin = margin(15, 15, 15, 15)
  )

# Display plot
print(p)

# Save the plot (wider and taller)
ggsave("visa_issuance_trends.png", plot = p, width = 20, height = 8, dpi = 300)

```

```{r echo=FALSE}
library(tidyr)
library(dplyr)
library(ggplot2)

# Step 1: Aggregate Visa Data to Find Top 5 Countries
visa_distribution <- analysis_data %>%
  group_by(Country, `Fiscal Year`, `Visa Category`) %>%
  summarise(Total.Visas = sum(`Quantity of U.S. Visas Granted`, na.rm = TRUE), .groups = 'drop')

top_countries <- visa_distribution %>%
  group_by(Country) %>%
  summarise(Total.Visas = sum(Total.Visas), .groups = 'drop') %>%
  slice_max(Total.Visas, n = 5) %>%
  pull(Country)

# Step 2: Filter Population Data for Top 5 Countries
filtered_population <- analysis_data %>%
  filter(Country %in% top_countries)

# Step 3: Aggregate Population by Country and Fiscal Year
population_growth_data <- filtered_population %>%
  group_by(Country, `Fiscal Year`) %>%
  summarise(Population = mean(Population, na.rm = TRUE), .groups = 'drop')

# Step 4: Plot Population Growth Over Time
p <- ggplot(population_growth_data, aes(x = `Fiscal Year`, y = Population, color = Country)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  
  # Labels and Titles
  labs(
    title = 'Population Growth of Top 5 Countries by Visa Issuance',
    subtitle = 'Trends over the years',
    x = 'Fiscal Year',
    y = 'Population',
    color = 'Country'
  ) +
  
  # Facet by country to mirror previous visa issuance chart
  facet_wrap(~ Country, nrow = 1, scales = 'free_y') +
  
  # Customize Colors and Themes
  scale_color_brewer(palette = 'Set2') +
  theme_minimal(base_size = 14) +
  
  # Improve Axis and Text Aesthetics
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
    axis.text.y = element_text(size = 8),
    strip.text = element_text(size = 8, face = 'bold'),
    plot.title = element_text(hjust = 0.5, size = 15, face = 'bold'),
    plot.subtitle = element_text(hjust = 0.5, size = 1),
    legend.position = 'top',
    legend.title = element_text(size = 10),
    legend.text = element_text(size = 10),
    plot.margin = margin(20, 20, 20, 20)
  )

# Display the Plot
print(p)

# Save the Plot
ggsave("population_growth_trends.png", plot = p, width = 40, height = 8, dpi = 300)

```

India and China lead in skilled labor and student visas, driven by expanding middle classes and workforce ambitions.

Mexico shows strong growth in unskilled labor visas, reflecting U.S. demand for labor in sectors like agriculture and services.

Japan and South Korea’s visa issuance is stable but lower, aligning with economic maturity and smaller youth populations seeking opportunities abroad.

Population growth directly influences U.S. visa issuance. Countries with expanding populations contribute more to migration flows, while aging nations see a slowdown. This relationship highlights the role of demographics in shaping global mobility and labor patterns.







```{r echo=FALSE}

library(tidyr)
library(dplyr)
library(ggplot2)
library(gridExtra)  # For combining plots

# Step 1: Load U.S. GDP Data from local file
local_gdp_data <- read.csv("https://github.com/annab0503/DS4002/raw/main/Project%201/Analysis%20Data/gdp_data.csv")
us_gdp_data_local <- subset(local_gdp_data, Country == 'United States')

# Step 2: Plot U.S. GDP Trends (Local Data)
p1 <- ggplot(us_gdp_data_local, aes(x = Fiscal.Year, y = GDP)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "darkblue", size = 2) +
  labs(
    title = 'US GDP 1997-2022',
    subtitle = 'Visualization of U.S. GDP trends by fiscal year',
    x = 'Fiscal Year',
    y = 'GDP (in billions USD)'
  ) +
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
    axis.text.y = element_text(size = 8),
    plot.title = element_text(hjust = 0.5, size = 12, face = 'bold'),
    plot.subtitle = element_text(hjust = 0.5, size = 8)
  )

# Step 3: Aggregate GDP data by country and fiscal year
gdp_data <- analysis_data %>%
  group_by(Country, `Fiscal Year`) %>%
  summarise(GDP = sum(GDP, na.rm = TRUE), .groups = 'drop')

# Step 4: Get Top 5 Countries by Visa Issuance
visa_distribution <- analysis_data %>%
  group_by(Country) %>%
  summarise(Total.Visas = sum(`Quantity of U.S. Visas Granted`, na.rm = TRUE), .groups = 'drop') %>%
  slice_max(Total.Visas, n = 5) %>%
  pull(Country)

# Step 5: Filter for Top 5 Countries Only (No U.S.)
filtered_gdp <- gdp_data %>%
  filter(Country %in% visa_distribution)

# Step 6: Plot GDP Trends for Top 5 Countries
p2 <- ggplot(filtered_gdp, aes(x = `Fiscal Year`, y = GDP, color = Country)) +
  geom_line(size = 1.2) +
  labs(
    title = 'GDP Trends of Top 5 Countries by Visa Issuance',
    subtitle = 'Comparison of GDP over 1997-2022',
    x = 'Fiscal Year',
    y = 'GDP (in billions)',
    color = 'Country'
  ) +
  facet_wrap(~ Country, nrow = 2, scales = 'free_y') +
  scale_color_manual(values = c(
    "China" = "blue",
    "India" = "green",
    "Mexico" = "purple",
    "Japan" = "orange",
    "Korea, South" = "brown"
  )) +
  theme_minimal(base_size = 7) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
    axis.text.y = element_text(size = 8),
    strip.text = element_text(size = 8, face = 'bold'),
    plot.title = element_text(hjust = 0.5, size = 11, face = 'bold'),
    plot.subtitle = element_text(hjust = 0.5, size = 8),
    legend.position = 'top'
  )

# Step 7: Combine the Two Plots Side by Side
combined_plot <- grid.arrange(p1, p2, ncol = 2)

# Save the combined plot
ggsave("combined_gdp_trends.png", plot = combined_plot, width = 20, height = 10, dpi = 300)
```





```{r echo=FALSE}
library(tidyr)
library(dplyr)
library(ggplot2)

# Step 1: Load U.S. Population Data from URL
us_pop_url <- "https://raw.githubusercontent.com/annab0503/DS4002/main/Project%201/Analysis%20Data/pop_data.csv"
us_pop_data <- read.csv(us_pop_url)

# Step 2: Aggregate Visa Issuance (Sum for All Countries by Year)
us_visa_data <- analysis_data %>%
  group_by(`Fiscal Year`) %>%
  summarise(Total.Visas = sum(`Quantity of U.S. Visas Granted`, na.rm = TRUE), .groups = 'drop')

# Step 3: Aggregate U.S. Population and RNI by Year
us_pop_agg <- us_pop_data %>%
  group_by(Fiscal.Year) %>%
  summarise(
    Population = sum(Population, na.rm = TRUE),
    RateOfNaturalIncrease = mean(Rate.of.Natural.Increase, na.rm = TRUE),  # Average RNI per year
    .groups = 'drop'
  )

# Step 4: Merge Population, RNI, and Visa Data by Fiscal Year (1997-2022)
merged_data <- left_join(us_pop_agg, us_visa_data, by = c("Fiscal.Year" = "Fiscal Year")) %>%
  drop_na(Population, Total.Visas) %>%
  filter(Fiscal.Year >= 1997 & Fiscal.Year <= 2022)

# Step 5: Create Scatter Plot for 1997-2022
p <- ggplot(merged_data, aes(x = Population / 1e6, y = Total.Visas / 1e6)) +
  
  # Scatter plot points for each year
  geom_point(aes(color = as.factor(Fiscal.Year)), size = 4) +
  
  # Add year labels to each point
  geom_text(aes(label = Fiscal.Year), vjust = -1, size = 3) +
  
  # Line for Rate of Natural Increase (on secondary log scale axis)
  geom_line(aes(x = Population / 1e6, y = log1p(RateOfNaturalIncrease)), color = "red", size = 1.2, linetype = "dashed") +
   annotate("text", x = 7000, y = log1p(max(merged_data$RateOfNaturalIncrease)), 
           label = "Rate of Natural Increase", color = "red", hjust = 0, size = 4) +
  
  # Titles and Labels
  labs(
    title = 'U.S. Population vs Total U.S. Visa Issuance(1997-2022)',
    subtitle = 'Relationship between U.S. population, global U.S. visa issuance, and Rate of Natural Increase',
    x = 'Population (in millions)',
    y = 'Visa Issuance (in millions)',
    color = 'Fiscal Year'
  ) +
  
  # Customize Theme
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = 'bold'),
    plot.subtitle = element_text(hjust = 0.5, size = 10),
    axis.text.x = element_text(size = 8),
    axis.text.y = element_text(size = 8),
    legend.position = 'right'
  ) +
  
  # Secondary y-axis for log-scaled Rate of Natural Increase
  scale_y_continuous(
    sec.axis = sec_axis(~ exp(.) - 1, name = "Rate of Natural Increase")
  )

# Display the plot
print(p)

# Save the plot
ggsave("us_population_vs_visas_rni_log_1997_2022.png", plot = p, width = 12, height = 8, dpi = 300)

```
#Visa Issuance Increases with Population Growth (1997-2019):

  -As the U.S. population grows (x-axis), visa issuance (y-axis) steadily rises.
  
  -From 1997 to 2019, visa issuance consistently increases, peaking around 2015-2019 when both population and visa issuance reach their highest levels.


#Declining RNI Drives Labor Demand (Red Dashed Line):

  -The Rate of Natural Increase (RNI) declines as population grows. A lower RNI indicates slower birth rates and aging populations, reducing the natural growth of the workforce.
  
  -This trend increases the demand for foreign labor, contributing to higher visa issuance, particularly for employment-based visas.


#2020 and Beyond – A Dip and Recovery:

  -Visa issuance drops sharply in 2020, likely due to the COVID-19 pandemic and travel restrictions.
  
  -By 2022, visa issuance rebounds, highlighting the ongoing need for foreign labor to offset the declining RNI and workforce shortages.

# **Conclusion**


# **Works Cited**

-   <https://www.dol.gov/agencies/whd/immigration/h1b>

-   <https://ccis.ucsd.edu/_files/wp11.pdf>

-   <https://www.migrationpolicy.org/article/h-1b-temporary-skilled-worker-program>

-   <https://timelines.issarice.com/wiki/Timeline_of_student_visa_policy_in_the_United_States>

-   <https://www.thecrimson.com/article/2020/12/11/trump-immigration-higher-education/>

-   <https://www.americanimmigrationcouncil.org/research/h1b-visa-program-fact-sheet>

-   Migration Policy Institute. [Migration Policy Institute Website](https://www.migrationpolicy.org/)

-   Preston, S., & Elo, I. (1995). *Demography: Analysis of Mortality and Fertility Rates*. [DOI: 10.1016/S0304-3932(02)00206-4](https://doi.org/10.1016/S0304-3932(02)00206-4).
